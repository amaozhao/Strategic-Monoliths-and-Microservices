# 需要平衡，需求策略

本书带领我们在业务战略、数字化转型、战略学习工具、事件优先建模、实现领域驱动的结果以及使用单体和微服务的有目的的架构的许多方面进行了紧张的旅程。
在这最后一章中，我们逐章总结了我们的旅程。不过，我们首先要强调一个关键信息：业务功能需求和质量属性之间必须保持平衡，后者必须通过确定目的来证明其合理性。如果组织要始终专注于战略创新，这种平衡是关键。

## 平衡和质量属性

软件架构是多维的。第 10 章“按照你的意思构建单体应用”中的“从头开始”部分强调了在平衡质量属性（例如性能、可扩展性、吞吐量、安全性等）时权衡的重要性。一个这样的权衡是在性能和可扩展性之间取得平衡，而不影响其中任何一个。选择这些要求中的哪一个更重要至关重要，因为不可能对两者进行同等优化。最终，其中之一必须在实现的质量属性方面具有优势。
因此，权衡取舍对于模块化单体应用和微服务同样重要。再看一下第 8 章“基础架构”中的质量属性。考虑所选架构如何影响质量属性，以及质量属性如何影响所选架构。不难理解为什么找到平衡如此重要。这是一个总结：

- 性能：网络延迟会影响性能。微服务需要一个网络，如果不是多个网络的话。通过确保更少的网络请求和同时发出网络请求，有多种降低延迟的选项。
- 可扩展性：当需要高可扩展性时，使用微服务有一个明显的优势，因为它们可以独立扩展软件的资源密集型部分。然而，如果 Monolith 被设计和实现为云原生系统，那么它可以部署为功能即服务 (FaaS) 组件，从而产生云规模的应用程序。
- 弹性、可靠性和容错性：单体和微服务都可以用这些重要的品质来设计和实现。使用 Monoliths 可以减少技术开销。使用 Actor 模型和其他单进程反应式架构方法可以提高单体和微服务的这些品质。
- 复杂性：在复杂性方面，单体应用和微服务之间有几个权衡，这往往会产生相反的结果。

本节中讨论的质量属性并非详尽无遗。例如，我们可以讨论可用性，以及它如何与我们讨论的需求相关联。当然，第 8 章中讨论的安全和隐私不是可选的。我们在这里的重点是在选择带来的与质量相关的后果中通常最显着的。
模块化 Monoliths 和微服务之间没有明显的赢家。与往常一样，了解环境权衡很重要。模块化 Monolith 非常适合需要性能、可靠性和尽可能低的复杂性的环境。微服务在可扩展性、可用性、可靠性和容错性方面大放异彩。决定采用哪种方法不是二元选择过程。相反，可以平衡选项以确保每个选项的最佳应用。
找到平衡很困难，尤其是在大型系统中，但有工具可以帮助我们做到这一点 [ATAM]。有时，甚至可能更多时候，模块化 Monolith 和微服务的混合会带来最大的回报。请记住，最终目标是开发产生突破性创新的具有战略意义的软件。

## 战略和目的
本书的首要主题是通过战略思维和战略软件开发来实现战略目标。回想一下在这段旅程中所探索的内容，逐章。

### 业务目标为数字化转型提供信息

业务目标应该是差异化的；否则，转型只是另一个追逐成本高昂但难以捉摸的流行词。以下是第 1 章“业务目标和数字化转型”中的重要思想。

- 如果纯粹的发明看起来几乎是不可能的，那么持续和顽强的改进就不是了。尽管如果你尝试从 A 跳到 Z，从 A 跳到 B，然后从 B 跳到 C，然后…… 是实现超越想象的创新的可行方法，例如从内部部署到云迁移. （有关为什么这是“想象转换”的提示，请参阅第 1 章中的“数字化转型：目标是什么？”一节。）
- 当缺乏知识和必要的捷径未被识别，然后通过知识获取和纠正性重构解决时，软件就会出错。一个大泥球成为了目的地，一切都变得缓慢，在里面呆了很长时间，很难摆脱硬化的泥浆。
- 在康威定律的影响下运作是生活中不可避免的事实。沟通是获取知识的关键，组织结构可以帮助或阻碍这一过程。围绕专业领域与合适的人员和清晰的沟通组织团队是成功创新的最佳方式。当然，我们不建议创建孤岛，而是在系统的专业领域内创建团队，包括跨团队沟通和总体共享目标。
- 头脑可以处于自动驾驶状态，也可以进行探索性和深入的思考。多维度和批判性地重新思考是挑战现状的好方法，目标是从一个普通的位置过渡到一个新的战略有利位置。
- 单体应用在设计不当时会造成破坏，而微服务在被盗用时则是灾难性的。架构有利于其预期目的。有目的的架构是最好的架构。
- #Agile 是团队的组成部分。如果它保持轻量级并专注于满足客户，那么团队就会朝着成功的方向前进。如果它变得重量级和仪式化，那么根据定义，使用它的人是在做#agile 而不是#agile。做#agile 会阻碍成功。
- 一个深陷债务泥潭并可能达到最大熵的软件系统需要数年甚至数十年的时间才能达到这一点。在这种情况下取得成功更多地取决于态度而不是分布式架构。积极的态度是通过信心培养的；信心是通过明智的选择和持续改进来实现的。

### 使用战略学习工具
战略是业务创造的什么方面，导致有意独特并产生利润来源组合的新举措。让文化成为工具。学习学习以获得战略优势是第 2 章“基本战略学习工具”的精髓。

- 决策是必要的。决定何时做出决定与目标决定同样重要。在最后负责任的时刻做出决定。犯错以便你最终可以正确是实验的目的。
- 在建立一种能够培养实验意愿的敏捷、容错的文化时，失败并不是致命的。为人们提供实验和失败所需的心理安全感只会增加商业成功和竞争优势。它使团队能够遵守康威定律。
- 首先设计模块并尽可能地推动长期部署决策。
- 为获得战略性的竞争优势而创新是很困难的。实现这一目标需要专注于基于业务能力的软件设计和应对业务挑战。不要让糟糕的架构和设计破坏业务创新。

### 事件驱动的轻量级建模

在软件开发中，一些基本概念是组件协同工作方式的基础。在协同应用组件的基本概念的同时快速建模软件是一种加速知识获取和成功的强大方法。使用第 3 章“事件优先实验和发现”中的这些工具。

- 软件建模是理解业务复杂性的重要组成部分。生成的模型用于将日常业务程序和流程与软件组件相关联。
- 首先使用事件建模，但包括命令、策略、实体和其他有助于学习的元素。这是一种用于实验的低技术工具，可导致了解高科技中的创新。
- 尽管用于面对面协作，但可以使用虚拟建模表面与远程团队在线模拟 EventStorming。
- 使用 EventStorming 大图建模是一种发现正在探索的系统整体流程的练习。这是迈向动态和快速学习的第一步。

### 推动业务创新

每个企业都有一个专门的知识领域，这是通过现有的专业知识以及集体和共享学习活动获得的。这种知识一旦反映在软件产品中，就会对消费者产生影响。实际上，企业拥有多个（如果不是很多）知识领域，第 II 部分中的章节深入探讨了利用核心部分的方法。

- 当谈到商业软件战略时，了解哪里投资最多，哪里投资最少是成功的关键。
- 软件涉及整个业务的广度和深度。大型企业中所有软件的整个领域或知识领域都非常庞大。使用域和子域的概念来理解问题空间和战略决策。
- 将特定的、集中的知识领域内的交流上下文分离为一个有界上下文。围绕交流的显着特征开发一种语言，并在边界内保持其含义的一致性。
- 了解系统内的特定核心、支持和通用子域。知道在哪里投资核心差异化，在哪里提供支持模型，以及哪里商业可用的解决方案最有效。
- 使用上下文映射来识别和改进团队间关系并选择适当的集成模式。

### 事件优先架构
并非每种架构风格和模式都适合任意一组任意的业务、技术、规模、性能或吞吐量限制。一组特定的约束将驱动一个有目的的架构。这些是第三部分章节的重要内容。

- 当外部设备与用于与软件服务或应用程序交互的其他机制之间存在根本差异时，可能会遇到问题。使用端口和适配器架构将技术与外部世界分离为提供给服务或应用程序的消耗性刺激。
- 消息驱动的架构强调发送和接收消息在整个系统中扮演着重要的角色。从这种架构中实现的好处包括软件组件和服务的松散耦合，以及在技术规定的任意时间内减少对预期结果的依赖。事件本质上是消息，因此消息驱动架构支持事件驱动架构。
- REST 是一种支持请求-响应操作的架构风格和模式。因此，即使在事件驱动的架构中，REST 也很有用。请求是使用基于动词的方法发出的。消费者可以使用请求来注册系统通过 REST-over-HTTP 发布的事件。
- 在使用域驱动方法的事件驱动架构的域模型中，可以使用强大的战术工具来管理业务域的复杂性：实体、值对象、聚合、域服务和功能行为。
- 在合适的情况下使用流程编排和编排来管理长期运行的系统范围的工作流。对于需要有限单个步骤的更简单的长时间运行的业务软件流程，编排是合适的。对于具有大量处理步骤的更复杂的流程，编排效果最好。
- 当维护服务或应用程序中所有过去发生的审计日志是一个业务问题时，请使用事件溯源。当查询很复杂时，使用命令查询职责分离 (CQRS)，并且组织可以通过在执行查询之前调整答案来实现优势。
- 在众多架构决策中，管理安全性和隐私当然不是最不重要的。事实上，近年来这些问题已经被推到了信息技术关注的前沿。

### 单体作为一阶关注点

从长远来看，构建和设计既有用又易于管理的 Monoliths 并不是白日做梦。对于大多数公司来说，开发长期使用的 Monoliths 很有意义。即使组织决定至少使用一些微服务，从模块化单体开始，也可以在最后负责的时刻做出决定。使用从第 10 章“按照你的意思构建单体应用”中汇编的以下建议，可以帮助团队专注于最重要的软件交付，而不是被他们可能从未需要的架构决策所左右。

- 可以使用简单的步骤从一开始就有效地构建和设计 Monolith。
- 寻求业务能力在 Monolith 中实现，因为公司的业务能力是各种模型之间划分的自然场所。这些决策将由参与以能力为中心的特定对话的业务专家和技术利益相关者推动。
- 即使在 Monolith 不幸成为 Big Ball of Mud 的家之后，组织也可以使用特定的措施，如第 10 章中详细解释的那样，形成模块化的 Monolith。
- 在从一个大泥球走过崎岖不平的道路以形成模块化的 Monolith 之后，保留模块化 Monolith 可能是最有意义的。

### 来自单体应用的有目的的微服务
如果有充分的理由将一些有界上下文从单体应用中分离为自治微服务，那么当组织从模块化单体应用开始工作时，这种转变将是最直接的。如果这对你来说不是一件奢侈的事情，并且有必要从大泥球过渡到微服务，那么你可以按照一些步骤使这种转变更容易发生。当有使用微服务的目的时，按照第 11 章“从单体到像老板一样的微服务”中的指导，你将踢[amorphous] 并取名。

- 与任何复杂的软件开发工作一样，在开始架构开发之旅之前，培养正确的思维方式非常重要。然而，在追求具有微服务架构的分布式系统时，一些挑战将非常突出。必须很好地理解性能、可伸缩性、可靠性和容错性以及其他复杂性。
- 从团队动态和技术角度来看，选择从 Monolith 中提取哪些有界上下文，即使是模块化的，也不是任意的。最佳人选基于变化率等因素；对自治的普遍需求，包括独立部署；表现;和可扩展性。
- 即使使用模块化的 Monolith，在早期阶段，团队也应该一次将一个粗粒度的上下文模块（限界上下文）提取到微服务中。寻找快速胜利。在获得经验和信心后，团队可能能够将多个限界上下文演变为一个微服务。如果这样做时遇到问题，团队可以回退到一次将一个限界上下文移动到微服务。
- 从大泥球中提取微服务非常具有挑战性，但团队可以使用一些措施来使其成功。谨慎行事，寻找能够取得胜利的机会。

### 平衡无偏见，创新必不可少

软件架构是多维的，它的演变需要对当前的权衡有一个清晰的理解。面对平衡非功能性需求，例如性能、可扩展性、吞吐量、安全性等，了解权衡并做出公正的决策至关重要。如果你想要不妥协的价值交付，请注意这些课程。

- 想象微服务自动提供更高的性能是错误的。了解权衡的唯一方法是测量。进程内方法调用比网络操作更快。
    性能和可扩展性可以通过不同的方式实现，而微服务在这方面并不总是明显的赢家。
- 使用“转型”作为追求微服务和/或云原生系统的借口并不是创新或差异化的。遵循这一行动方针必须提供优势。许多公司已经在不必要的时候采用了微服务和云原生系统，并为这些错误的决策付出了沉重的代价，无论是在财务上还是在运营上。
- 必须寻求业务目标以实现差异化价值。这并不否定采取其他战略或战术举措，例如迁移到云或使用微服务。最终，这些决策应该帮助企业实现差异化价值，而不是阻碍它。
- 犯错以便你最终可以正确是实验的目的。知识工作者在寻求获取知识时必须感到安全和安全。
- 在问“为什么？”时练习深入思考和批判性思维。那么为何不？”尝试实现战略业务目标。应用战略思维和持续改进，从而形成与众不同的软件系统。

## 结论
2011年，福布斯发表了一篇题为“现在每家公司都是一家软件公司”的文章[Forbes-ECSC]。那篇文章断言：
传统产业和科技产业分离的时代已经结束——那些现在不能适应的人很快就会发现自己已经过时了。

> 现在，至少在这些话写下 10 年后，许多公司都采用了这种观点。还有更多的公司没有。还有其他公司介于两者之间。

这是否意味着在数字化转型方面没有取得很大进展的公司现在已经过时了？寻找可能在几年内取代该公司的初创公司。大公司的一个问题是他们不能快速行动。另一个问题是他们无法察觉自己的缓慢死亡，因为他们无法理解一个季度发生了 20,000,000 美元的损失，因为消费者正在转向明亮、年轻、敏捷的竞争。该公司甚至可能根本不知道这家新创业公司，或者只知道五分之一的严峻挑战者。
这个困境的答案不是让大公司去寻宝，寻找所有可以吃他们午餐的新创业公司——也就是说，除非购买他们的午餐（收购）是防止这种命运的唯一途径。允许并实际支持灵活的初创公司以未来收购的想法对你的公司进行创新并不是一个很好的策略。这些公司可能排在第二位，也可能比发行价低几十亿美元。独角兽发生。
不要牺牲将当前核心软件系统转变为你所在行业的下一代 SaaS 或 PaaS 的机会。我们，作者，真的希望为你的旅程提供动力和灵感，或者在已经开始的道路上继续创新。

## 参考

- [ATAM] https://resources.sei.cmu.edu/library/asset-view.cfm?assetid=513908
- [福布斯-ECSC] https://www.forbes.com/sites/techonomy/2011/11/30/now-every-company-is-a-software-company/?sh=7cfd5ec2f3b1